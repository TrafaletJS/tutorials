"use strict";function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function intersectArrays(){var e,t,n,i,a,r,o=[],s={};try{for(r=arguments.length-1,n=arguments[0].length,t=0,e=0;e<=r;e++)(i=arguments[e].length)<n&&(t=e,n=i);for(e=0;e<=r;e++){i=e===t?0:e||t,a=arguments[i].length;for(var u=0;u<a;u++){var l=arguments[i][u];s[l]===e-1?e===r?(o.push(l),s[l]=0):s[l]=e:0===e&&(s[l]=0)}}}catch(e){o=[]}return o}function getPerformanceTime(){var e=availableOnDOM("now","performance"),t=void 0;return e?(t=window.getValueOf(e),t.call(performance)):(new Date).getTime()}function availableOnDOM(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=["webkit","moz","o","ms"],i=[];t?i.push(t.dotize(e)):i.push(e),n.forEach(function(n){t?i.push(t.dotize(n+e.capitalizeFirstLetter())):i.push(n+e.capitalizeFirstLetter())});for(var a in i)if(!1!==window.getValueOf(i[a],!1))return i[a];return!1}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_slicedToArray=function(){function e(e,t){var n=[],i=!0,a=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);i=!0);}catch(e){a=!0,r=e}finally{try{!i&&s.return&&s.return()}finally{if(a)throw r}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),TJS={};!function(){var e=void 0,t=function(){function t(){_classCallCheck(this,t),this.settings={}}return _createClass(t,[{key:"set",value:function(e,t){this.setValueOf(e,t)}},{key:"get",value:function(e){return this.getValueOf(e,function(){throw new Error("Cannot retrieve config var %s".sprintf(e))})}},{key:"has",value:function(e){return!1!==this.getValueOf(e,!1)}}],[{key:"getInstance",value:function(){return!1==e instanceof t&&(e=new t),e}}]),t}();Object.defineProperty(TJS,"Config",{value:t.getInstance(),enumerable:!1,writable:!1})}(),function(){var e=new Map,t=new Map,n=function(){function n(){_classCallCheck(this,n)}return _createClass(n,null,[{key:"Start",value:function(t){e.set(t,getPerformanceTime())}},{key:"End",value:function(n){void 0===t.get(n)&&t.set(n,{count:0,total:0}),t.get(n).count+=1,t.get(n).total+=getPerformanceTime()-e.get(n)}},{key:"Get",value:function(e){var n=t.get(e);void 0===n?console.log("Unknown timer::",e):console.log("Section:: [",e,"] Run count::",n.count,"Time total::",parseFloat(n.total).toFixed(2),"ms. AVG::",parseFloat(n.total/n.count).toFixed(2),"ms")}},{key:"List",value:function(){var e=!0,n=!1,i=void 0;try{for(var a,r=t[Symbol.iterator]();!(e=(a=r.next()).done);e=!0){var o=_slicedToArray(a.value,2),s=o[0],u=o[1];console.log("Section:: [",s,"] Run count::",u.count,"Time total::",parseFloat(u.total).toFixed(2),"ms. AVG::",parseFloat(u.total/u.count).toFixed(2),"ms")}}catch(e){n=!0,i=e}finally{try{!e&&r.return&&r.return()}finally{if(n)throw i}}}}]),n}();Object.defineProperty(TJS,"Timer",{value:n,enumerable:!1,writable:!1})}(),function(){Object.defineProperty(Object.prototype,"setValueOf",{enumerable:!1,value:function(e,t,n,i){var a=void 0,r=void 0,o=void 0,s=Object(this);if(void 0===n&&(n=!1),void 0!==e){a=e.toString().split(".");for(var u=0;u<a.length;u+=1)r=a[u],o=s[r],void 0===o?u<a.length-1?(s[r]={},s=s[r]):i||n||(s[r]=t):s=s[r],i&&(u<a.length-1||void 0===s[r]&&Object.defineProperty(s,r,{value:t,enumerable:i.enumerable||!0,writable:i.writable||!0,configurable:i.configurable||!0})),n&&void 0!==o&&(u<a.length-1||(s[r]=t));return this.getValueOf(e,!1)}}}),Object.defineProperty(Object.prototype,"getValueOf",{enumerable:!1,value:function(e,t){var n=void 0,i=void 0,a=void 0;if(void 0!==e){if("object"===(void 0===e?"undefined":_typeof(e)))return e;i=e.toString().split("."),a=this,n="";var r=!0,o=!1,s=void 0;try{for(var u,l=i[Symbol.iterator]();!(r=(u=l.next()).done);r=!0){var c=u.value;if(void 0===a[c]){n=void 0;break}a=a[c]}}catch(e){o=!0,s=e}finally{try{!r&&l.return&&l.return()}finally{if(o)throw s}}return void 0===n?(n=t,"function"==typeof t&&(n=t())):n=a,n}}}),Object.defineProperty(Object.prototype,"unsetValueOf",{enumerable:!1,value:function(e){var t=e.split("."),n=void 0;if("function"==typeof e||"string"!=typeof e)return!1;1<t.length?(e=t.pop(),n=this.getValueOf(t.join("."))):n=this;try{delete n[e]}catch(e){return!1}return this}}),Object.defineProperty(Object.prototype,"updateValueOf",{enumerable:!1,value:function(e,t){var n,i,a;return void 0===this.getValueOf(e)?this.setValueOf(e,t):(n=e.split("."),1<n.length&&"function"!=typeof t?(a=n.pop(),i=this.getValueOf(n.join(".")),void 0!==i&&(i[a]=t),t):(this[e]=t,t))}}),Object.defineProperty(Object.prototype,"addHiddenData",{value:function(){this.setValueOf("_hiddenData",{},!1,{enumerable:!1})}}),Object.defineProperty(Object.prototype,"setHiddenData",{value:function(e,t){this.addHiddenData(),this.setValueOf("_hiddenData".dotize(e),t)}}),Object.defineProperty(Object.prototype,"updateHiddenData",{value:function(e,t){this.addHiddenData(),this.updateValueOf("_hiddenData".dotize(e),t)}}),Object.defineProperty(Object.prototype,"getHiddenData",{value:function(e){return this.addHiddenData(),this.getValueOf("_hiddenData".dotize(e))}}),Object.defineProperty(Object.prototype,"xpand",{enumerable:!1,value:function(e,t){var n,i={$push:function(e,t,n){void 0!==e.getValueOf(t)&&(!0==n instanceof Array?e.updateValueOf(t,e.getValueOf(t,[]).concat(n)):"object"!==(void 0===n?"undefined":_typeof(n))&&e.getValueOf(t,[]).push(n))}};if("object"!==(void 0===e?"undefined":_typeof(e)))return!1;for(n in e)!0===e.hasOwnProperty(n)&&(-1!==Object.keys(i).indexOf(n)?Object.keys(e[n]).forEach(function(t){i[n](this,t,e[n][t])}.bind(this)):!0===this.hasOwnProperty(n)?(_typeof(this[n])===_typeof(e[n])&&"object"===_typeof(this[n])&&Object.keys(e[n]).forEach(function(i){null===this[n]||void 0===this[n]?this[n]=e[n]:null!==this[n].getValueOf(i,null)?t&&(this[n][i]=e[n][i]):this[n][i]=e[n][i]}.bind(this)),void 0!==t&&!0===t&&(this[n]=e[n])):this[n]=e[n]);return this}}),Object.defineProperty(Object.prototype,"without",{value:function(){var e;for(e in arguments)this.unsetValueOf(arguments[e]);return this}}),Object.defineProperty(Object.prototype,"softClone",{value:function(){return JSON.parse(JSON.stringify(this))}}),Object.defineProperty(Object.prototype,"deepClone",{value:function(e){var t=this,n={};return e&&(n=[]),Object.keys(this).forEach(function(e){"object"===_typeof(t[e])?!0==t[e]instanceof RegExp?n[e]=new RegExp(t[e]):Array.isArray(t[e])?n[e]=t[e].deepClone(!0):null===t[e]?n[e]=null:n[e]=t[e].deepClone():(t[e],n[e]=t[e])}),n}}),Object.defineProperty(Object.prototype,"setSchema",{value:function(e){this.updateHiddenData("schema",e)}}),Object.defineProperty(Object.prototype,"createNewItem",{value:function(e){var t,n;return t=this.getHiddenData("schema"),n=t.softClone(),n.xpand(e,!0),n}}),Object.defineProperty(Object.prototype,"setEmitter",{value:function(e){this.updateHiddenData("emitter",e)}}),Object.defineProperty(Object.prototype,"getEmitter",{value:function(){return this.getHiddenData("emitter")}}),Object.defineProperty(Object.prototype,"createObservableProperty",{value:function(e){Object.defineProperty(this,e,{enumerable:!0,get:function(){return this.getValueOf("mutable".dotize(e,"value"))},set:function(t){var n,i;return this.setValueOf("mutable",{},!1,{enumerable:!1}),i=this.getValueOf(e),LiveHandler.emitKey(this,"before.change",e,t,i),n=this.updateValueOf("mutable".dotize(e,"value"),t),LiveHandler.emitKey(this,"change",e,t,i),n}})}}),Object.defineProperty(Object.prototype,"createObservableProperties",{value:function(e){if(!1==e instanceof Array)return!1;e.forEach(function(e){this.createObservableProperty(e)}.bind(this))}})}(),Object.defineProperty(String.prototype,"toUniqueId",{value:function(e){var t="",n=10,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";i+=this.toString(),void 0!==e&&(n=e);for(var a=0;a<n;a+=1)t+=i.charAt(Math.floor(Math.random()*i.length));return t}}),Object.defineProperty(String.prototype,"sprintf",{value:function(){var e=void 0;e=this.toString();for(var t=arguments.length,n=Array(t),i=0;i<t;i++)n[i]=arguments[i];var a=!0,r=!1,o=void 0;try{for(var s,u=n[Symbol.iterator]();!(a=(s=u.next()).done);a=!0){var l=s.value;e=e.replace("%s",l)}}catch(e){r=!0,o=e}finally{try{!a&&u.return&&u.return()}finally{if(r)throw o}}return e}}),Object.defineProperty(String.prototype,"dotize",{value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return[this.toString(),[].join.call(t,".")].join(".")}}),Object.defineProperty(String.prototype,"capitalizeFirstLetter",{value:function(){return this.charAt(0).toUpperCase()+this.slice(1)}}),Object.defineProperty(String.prototype,"toSlug",{value:function(){return this.toString().toLowerCase().trim().replace(/\s+/g,"-").replace(/&/g,"-and-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-")}}),Object.defineProperty(String.prototype,"truncate",{value:function(e,t){return this.toString().length>e?this.toString().slice(0,e)+t:this.toString()}}),function(){function e(e){var t=1;return"-"===e[0]&&(t=-1,e=e.substr(1)),function(n,i){return(n[e]<i[e]?-1:n[e]>i[e]?1:0)*t}}function t(){for(var t=arguments.length,n=Array(t),i=0;i<t;i++)n[i]=arguments[i];return function(t,i){for(var a=0,r=0,o=n.length;0===r&&a<o;)r=e(n[a])(t,i),a+=1;return r}}Object.defineProperty(Array.prototype,"sortBy",{value:function(){return this.sort(t.apply(null,arguments))}}),Object.defineProperty(Array.prototype,"pluck",{value:function(e){var t=[];if("object"!==(void 0===e?"undefined":_typeof(e)))throw new Error("Array.prototype.pluck needs an object as a schema");return this.forEach(function(n){var i={};Object.keys(e).forEach(function(t){try{i.setValueOf(t,n.getValueOf(e[t],e[t]))}catch(a){i.setValueOf(t,e[t](n))}finally{i.setValueOf(t,e[t])}}),t.push(i)}),t}})}(),function(){Object.defineProperty(HTMLElement.prototype,"html",{get:function(){return this.innerHTML},set:function(e){return this.innerHTML=e}}),Object.defineProperty(HTMLElement.prototype,"getMappedValue",{value:function(){if(this.getHiddenData("map"))return this.getHiddenData("map");switch(this.nodeName){default:return"html";case"INPUT":switch(this.type){default:return"value";case"checkbox":return"checked"}break;case"SELECT":return"selected";case"TEXTAREA":return"value"}}}),Object.defineProperty(HTMLElement.prototype,"set",{value:function(e){void 0===this.getValueOf(this.getMappedValue())&&this.setAttribute(this.getMappedValue(),e),this.updateValueOf(this.getMappedValue(),e)}}),Object.defineProperty(HTMLElement.prototype,"get",{value:function(){return this.getValueOf(this.getMappedValue())}}),Object.defineProperty(HTMLElement.prototype,"itemName",{set:function(e){this.updateHiddenData("element.itemName",e),this.hasAttribute("data-item")||this.setAttribute("data-item",e)},get:function(){return this.getHiddenData("element.itemName")||this.updateHiddenData("element.itemName",this.getAttribute("data-item")),this.getHiddenData("element.itemName")}}),Object.defineProperty(HTMLElement.prototype,"getContainers",{value:function(){return this.getValueOf("containers",function(){return this.setValueOf("containers",[]).concat(Array.prototype.slice.call(this.querySelectorAll("[data-container]")))}.bind(this))}}),Object.defineProperty(HTMLElement.prototype,"show",{value:function(){this.style.display="block"}}),Object.defineProperty(HTMLElement.prototype,"hide",{value:function(){this.style.display="none"}}),Object.defineProperty(HTMLElement.prototype,"live",{value:function(){return!this.getHiddenData("elementIsLive")&&(this.updateHiddenData("elementIsLive",!0),new LiveHandler(this),!0)}}),Object.defineProperty(HTMLElement.prototype,"isLive",{value:function(){return!!this.getHiddenData("elementIsLive")}})}(),function(){Object.defineProperty(HTMLSelectElement.prototype,"selected",{set:function(e){var t=void 0;Array.from(this.options).forEach(function(e){e.selected&&(t=e)}),!0===Array.isArray(e)?this.setOptions(e,!0,t):Array.from(this.options).map(function(t){t.value&&t.value==e&&(t.selected=!0)})},get:function(){var e=void 0;return Array.from(this.options).forEach(function(t){t.selected&&(e=t)}),e}}),Object.defineProperty(HTMLSelectElement.prototype,"setOptions",{value:function(e,t,n){var i,a=!1;void 0===t&&(t=!0),t&&(this.html=""),!1==e instanceof Array&&"object"===(void 0===e?"undefined":_typeof(e))&&(e=[e]),e.forEach(function(e){var t=!1;i=document.createElement("option"),i.value=e.value,i.html=e.html,i.selected=e.selected||!1,"object"===_typeof(e.data)&&Object.keys(e.data).forEach(function(t){i.setValueOf("attrs",{})[t]=e.data[t],i.setValueOf("data".dotize(t),e.data[t])}),!0===e.selected?a=!0:void 0!==e.selectBy&&!0==e.selectBy instanceof Array&&void 0!==n&&null!==n&&(e.selectBy.forEach(function(i){e.getValueOf(i)!=n.getValueOf(i)||t||(t=!0)}),t&&(i.selected=!0,a=!0)),this.appendChild(i)}.bind(this)),!1===a&&(this.options[0].selected=!0)}}),Object.defineProperty(HTMLSelectElement.prototype,"list",{value:function(){var e=[];return Array.from(this.options).forEach(function(t){e.push({value:t.value,html:t.html,selected:t.selected})}),e}}),Object.defineProperty(HTMLSelectElement.prototype,"addOptions",{value:function(e,t){!0==e instanceof Array&&this.setOptions(e,t,this.selected)}}),Object.defineProperty(HTMLSelectElement.prototype,"addOption",{value:function(e,t){this.setOptions(e,t,this.selected)}}),Object.defineProperty(HTMLSelectElement.prototype,"isSelected",{value:function(e){var t;return[].forEach.call(this.options,function(n){n.value&&n.value===e&&n.selected&&(t=n)}),void 0!==t}})}(),function(){Object.defineProperty(HTMLElement.prototype,"isContainer",{value:function(){return this.hasAttribute("data-container")}}),Object.defineProperty(HTMLElement.prototype,"getShallowClone",{value:function(){return this.getHiddenData("_shallow")?this.getHiddenData("_shallow"):(this.updateHiddenData("_shallow",this.cloneNode(!0)),this.getHiddenData("_shallow"))}}),Object.defineProperty(HTMLElement.prototype,"getContainerName",{value:function(){if(this.isContainer())return this.getValueOf("containerName",function(){return this.setValueOf("containerName",this.getAttribute("data-container"))}.bind(this))}}),Object.defineProperty(HTMLElement.prototype,"eagerInsert",{value:function(e){this.isContainer()&&this.getShallowClone().appendChild(e)}}),Object.defineProperty(HTMLElement.prototype,"render",{value:function(){this.isContainer()&&this.parentNode.replaceChild(this.getShallowClone(),this)}})}(),function(){Object.defineProperty(HTMLElement.prototype,"getContainer",{value:function(e){var t=this.querySelector("[data-container='%s']".sprintf(e));if(!t)throw new Error("No container named %s has been found on the given template".sprintf(e));return t}}),Object.defineProperty(HTMLElement.prototype,"getBlock",{value:function(e){var t=this.querySelector("[data-block='%s']".sprintf(e));if(!t)throw new Error("No block named %s has been found on the given template".sprintf(e));return t}})}();var Device=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"isMobile",value:function(){return/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent)}}]),e}(),LiveHandler=function(){function e(t){_classCallCheck(this,e),this.element=t,this.element.setEmitter(new TJS.Events(this.element.itemName)),this.build()}return _createClass(e,[{key:"parseMapParams",value:function(){this.element.hasAttribute("data-map")&&(this.element.updateHiddenData("map",this.element.getAttribute("data-map")),this.element.removeAttribute("data-map"))}},{key:"build",value:function(){this.parseMapParams(),this.attachInputHandlers(),this.createCustomElementHandler()}},{key:"attachInputHandlers",value:function(){return!0===Device.isMobile()?(TouchHandler.New(this.element),!0):(MouseHandler.New(this.element),KeyboardHandler.New(this.element),!0)}},{key:"createCustomElementHandler",value:function(){switch(this.element.nodeName){case"INPUT":new InputElementHandler(this.element).handle();break;case"SELECT":new SelectElementHandler(this.element).handle()}}}],[{key:"emit",value:function(e,t){if(e.getEmitter()){for(var n=arguments.length,i=Array(n>2?n-2:0),a=2;a<n;a++)i[a-2]=arguments[a];e.getEmitter().emit.apply(e.getEmitter(),[[e.itemName,t].join(":")].concat(i))}}},{key:"emitKey",value:function(e,t,n){if(e.getEmitter()){for(var i=arguments.length,a=Array(i>3?i-3:0),r=3;r<i;r++)a[r-3]=arguments[r];e.getEmitter().emit.apply(e.getEmitter(),[[n,t].join(":")].concat(a))}}}]),e}(),InputElementHandler=function(){function e(t){_classCallCheck(this,e),this.element=t}return _createClass(e,[{key:"handle",value:function(){var e=this;switch(this.element.type){case"checkbox":this.element.onchange=function(t){LiveHandler.emit(e.element,"checked",t.target.checked,t.target)};break;case"text":case"search":case"number":this.element.onkeyup=function(t){LiveHandler.emit(e.element,"keyup",t.target.get(),t.target,t)},this.element.onchange=function(t){LiveHandler.emit(e.element,"changed",t.target.get(),t.target)},this.element.oninput=function(t){LiveHandler.emit(e.element,"input",t.target.get(),t.target)},this.element.onblur=function(t){LiveHandler.emit(e.element,"blur",t.target.get(),t.target)},this.element.onpaste=function(t){LiveHandler.emit(e.element,"paste",t.target.get(),t.target)}}}}]),e}(),SelectElementHandler=function(){function e(t){_classCallCheck(this,e),this.element=t}return _createClass(e,[{key:"handle",value:function(){var e=this;this.element.onchange=function(t){LiveHandler.emit(e.element,"selected",t.target.selected.value,t.target)}}}]),e}(),_touchEvents=["touchstart","touchmove","touchend","touchcancel"],TouchHandler=function(){function e(t){_classCallCheck(this,e),this.element=t,this.lastEvent=!1}return _createClass(e,[{key:"build",value:function(){var e=!0,t=!1,n=void 0;try{for(var i,a=_touchEvents[Symbol.iterator]();!(e=(i=a.next()).done);e=!0){var r=i.value;this.element.addEventListener(r,this.handler.bind(this),!1)}}catch(e){t=!0,n=e}finally{try{!e&&a.return&&a.return()}finally{if(t)throw n}}}},{key:"destroy",value:function(){var e=!0,t=!1,n=void 0;try{for(var i,a=_touchEvents[Symbol.iterator]();!(e=(i=a.next()).done);e=!0){var r=i.value;this.element.removeEventListener(r,this.handler.bind(this),!1)}}catch(e){t=!0,n=e}finally{try{!e&&a.return&&a.return()}finally{if(t)throw n}}}},{key:"handler",value:function(e){switch(e.type){case _touchEvents[0]:this._castEvent("inputdown",{event:e,lastEvent:this.lastEvent}),this._updateLastTouch(_touchEvents[0]);break;case _touchEvents[1]:this._castEvent("inputmoving",{event:e,lastEvent:this.lastEvent}),this._updateLastTouch(_touchEvents[1]);break;case _touchEvents[2]:if(this.lastEvent===_touchEvents[1])return this._castEvent("inputcancel",{event:e,lastEvent:this.lastEvent}),!1;this._castEvent("inputup",{event:e,lastEvent:this.lastEvent}),this._updateLastTouch(_touchEvents[2]);break;case _touchEvents[3]:}}},{key:"_updateLastTouch",value:function(e){!1===this.lastEvent&&(this.lastEvent=e),this.lastEvent!==e&&(this.lastEvent=e)}},{key:"_castEvent",value:function(e,t){var n=this;setTimeout(function(){LiveHandler.emit(n.element,e,n.element.get(),n.element,t),"inputup"===e&&LiveHandler.emit(n.element,"clicked",n.element.get(),n.element,t)},5)}}],[{key:"New",value:function(t){return new e(t).build()}}]),e}(),_mouseEvents=["mousedown","mousemove","mouseup","mousewheel","DOMMouseScroll","contextmenu"],_suppressable={inputrightdown:"rightclick"},MouseHandler=function(){function e(t){_classCallCheck(this,e),this.element=t,this.lastEvent=!1,this.suppressed=[],this.position={initX:0,initY:0,distance:0},this.mouseDownState=!1,this.setSuppressedDefaults()}return _createClass(e,[{key:"setSuppressedDefaults",value:function(){var e=this;!0===this.element.hasAttribute("suppress-default")&&this.element.getAttribute("suppress-default").split("|").forEach(function(t){e.suppressed.push(t)})}},{key:"getSuppressedDefaults",value:function(){return this.suppressed}},{key:"build",value:function(){var e=!0,t=!1,n=void 0;try{for(var i,a=_mouseEvents[Symbol.iterator]();!(e=(i=a.next()).done);e=!0){var r=i.value;this.element.addEventListener(r,this.handler.bind(this),!1)}}catch(e){t=!0,n=e}finally{try{!e&&a.return&&a.return()}finally{if(t)throw n}}}},{key:"destroy",value:function(){var e=!0,t=!1,n=void 0;try{for(var i,a=_mouseEvents[Symbol.iterator]();!(e=(i=a.next()).done);e=!0){var r=i.value;this.element.removeEventListener(r,this.handler.bind(this),!1)}}catch(e){t=!0,n=e}finally{try{!e&&a.return&&a.return()}finally{if(t)throw n}}}},{key:"handler",value:function(e){switch(e.type){case _mouseEvents[0]:this._setMouseDownState(!0),this._setLastPosition(e.clientX,e.clientY),1===e.which&&(this._castEvent("inputdown",{event:e,lastEvent:this.lastEvent}),this._updateLastEvent("inputdown")),2===e.which&&(this._castEvent("inputscrolldown",{event:e,lastEvent:this.lastEvent}),this._updateLastEvent("inputscrolldown"));break;case _mouseEvents[1]:!0===this._isMouseDownState()&&this._setCurrentPosition(e.clientX,e.clientY),this._castEvent("inputmoving",{event:e,lastEvent:this.lastEvent}),this._updateLastEvent("inputmoving");break;case _mouseEvents[2]:if(!0===this._isPositionSafe()&&!0===this._isMouseDownState()){this._castEvent("inputup",{event:e,lastEvent:this.lastEvent}),this._setMouseDownState(!1),this._resetPosition(),this._updateLastEvent("inputup");break}this._castEvent("inputcancel",{event:e,lastEvent:this.lastEvent}),this._setMouseDownState(!1),this._resetPosition(),this._updateLastEvent("inputcancel");break;case _mouseEvents[3]:case _mouseEvents[4]:this._castEvent("inputscroll",{event:e,lastEvent:this.lastEvent}),this._updateLastEvent("inputscroll");break;case _mouseEvents[5]:this._castEvent("inputrightdown",{event:e,lastEvent:this.lastEvent}),this._updateLastEvent("inputrightdown")}}},{key:"_updateLastEvent",value:function(e){!1===this.lastEvent&&(this.lastEvent=e),this.lastEvent!==e&&(this.lastEvent=e)}},{key:"_castEvent",value:function(e,t){var n=this;0<this.getSuppressedDefaults().length&&-1!==this.getSuppressedDefaults().indexOf(_suppressable[e])&&(t.event.stopPropagation(),t.event.preventDefault()),setTimeout(function(){LiveHandler.emit(n.element,e,n.element.get(),n.element,t),"inputup"===e&&LiveHandler.emit(n.element,"clicked",n.element.get(),n.element,t)},5)}},{key:"_isMouseDownState",value:function(){return this.mouseDownState}},{key:"_setMouseDownState",value:function(e){this.mouseDownState=e}},{key:"_setCurrentPosition",value:function(e,t){this.position.distance=Math.round(Math.sqrt(Math.pow(this.position.initY-t,2)+Math.pow(this.position.initX-e,2)))}},{key:"_setLastPosition",value:function(e,t){this.position.initX=e,this.position.initY=t}},{key:"_resetPosition",value:function(){this.position.initX=0,this.position.initY=0,this.position.distance=0}},{key:"_isPositionSafe",value:function(){return 20>this.position.distance}}],[{key:"New",value:function(t){return new e(t).build()}}]),e}(),_keyboardEvents=["keydown","keypress","keyup"],KeyboardHandler=function(){function e(t){_classCallCheck(this,e),this.element=t,this.lastEvent=!1,this.suppressed=[],this.setSuppressedDefaults()}return _createClass(e,[{key:"setSuppressedDefaults",value:function(){var e=this;!0===this.element.hasAttribute("suppress-default")&&this.element.getAttribute("suppress-default").split("|").forEach(function(t){e.suppressed.push(t)})}},{key:"getSuppressedDefaults",value:function(){return this.suppressed}},{key:"build",value:function(){var e=!0,t=!1,n=void 0;try{for(var i,a=_keyboardEvents[Symbol.iterator]();!(e=(i=a.next()).done);e=!0){var r=i.value;this.element.addEventListener(r,this.handler.bind(this),!1)}}catch(e){t=!0,n=e}finally{try{!e&&a.return&&a.return()}finally{if(t)throw n}}}},{key:"destroy",value:function(){var e=!0,t=!1,n=void 0;try{for(var i,a=_keyboardEvents[Symbol.iterator]();!(e=(i=a.next()).done);e=!0){var r=i.value;this.element.removeEventListener(r,this.handler.bind(this),!1)}}catch(e){t=!0,n=e}finally{try{!e&&a.return&&a.return()}finally{if(t)throw n}}}},{key:"handler",value:function(e){switch(e.type){case _keyboardEvents[0]:this._castEvent("inputkeydown",{event:e,lastEvent:this.lastEvent}),this._updateLastEvent("inputkeydown");break;case _keyboardEvents[1]:this._castEvent("inputkeypress",{event:e,lastEvent:this.lastEvent}),this._updateLastEvent("inputkeypress");break;case _keyboardEvents[2]:this._castEvent("inputkeyup",{event:e,lastEvent:this.lastEvent}),this._updateLastEvent("inputkeyup")}}},{key:"_updateLastEvent",value:function(e){!1===this.lastEvent&&(this.lastEvent=e),this.lastEvent!==e&&(this.lastEvent=e)}},{key:"_castEvent",value:function(e,t){var n=[],i=void 0,a=void 0;a=t.event.key.toLowerCase(),!0===t.event.altKey&&n.push("alt"),!0===t.event.ctrlKey&&n.push("ctrl"),!0===t.event.shiftKey&&n.push("shift"),n.push(a),i=n.join("+"),0<this.getSuppressedDefaults().length&&-1!==this.getSuppressedDefaults().indexOf(i)&&(t.event.stopPropagation(),t.event.preventDefault()),LiveHandler.emit(this.element,e,this.element.get(),this.element,t),LiveHandler.emit(this.element,e+":"+i,this.element.get(),this.element,t)}}],[{key:"New",value:function(t){return new e(t).build()}}]),e}(),DOMHelper=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"parseTemplates",value:function(e,t){var n,i;n=t,i=document.createDocumentFragment(),i.appendChild(n),"string"==typeof t&&(n=document.querySelector(t)),[].forEach.call(n.querySelectorAll("script"),function(e){var t=document.createElement("script");Object.keys(e.attributes).forEach(function(n){t.setAttribute(e.attributes[n].name,e.attributes[n].value)}),t.onload=function(){t.parentNode.removeChild(t)},e.parentNode.removeChild(e),document.head.appendChild(t)}),[].forEach.call(n.querySelectorAll("link"),function(e){}),[].forEach.call(n.querySelectorAll("[data-template]"),function(t){for(var n=t.getAttribute("data-template"),i=t.parentNode,a=[];null!==i&&i instanceof HTMLElement;)i.getAttribute("data-namespace")&&a.push(i.getAttribute("data-namespace")),i=i.parentNode;0<a.length&&(n=[a.join("."),n].join("::")),TJS.module(e).addTemplate(n,t),t.parentNode.removeChild(t),t.removeAttribute("data-template")})}},{key:"parseMapParam",value:function(e){e.hasAttribute("data-map")&&(e.addHiddenData("map",e.getAttribute("data-map")),e.removeAttribute("data-map"))}}]),e}();!function(){var e=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"get",value:function(e,t){return t||(t=document),t.querySelector(e)}},{key:"getAll",value:function(e,t){return t||(t=document),t.querySelectorAll(e)}},{key:"getContainer",value:function(e){return document.querySelector("[data-container='%s']".sprintf(e))}},{key:"ready",value:function(e){document.addEventListener("DOMContentLoaded",e)}}]),e}();Object.defineProperty(TJS,"dom",{value:e,enumerable:!1,writable:!1})}(),function(){var e=function(){function e(){_classCallCheck(this,e),this.storage={},this.groups={},this.ids={}}return _createClass(e,[{key:"add",value:function(e,t,n,i){var a=void 0;return void 0===n&&(n=!1),a={event:e,handler:t,group:n,once:i,active:!0,id:"9023u490289".toUniqueId(16)},this.storage.setValueOf(e,[]).push(a),this.ids.setValueOf(a.id,a),n&&this.groups.setValueOf(n,[]).push(e),a.id}},{key:"removeEventKeys",value:function(e,t,n){void 0===n&&(n=this.storage),t.forEach(function(t){n.getValueOf(e,[]).splice(t,1)})}},{key:"remove",value:function(e,t){t||(t=this.storage);var n=[];t.getValueOf(e,[]).map(function(e,t){n.push(t)}),this.removeEventKeys(e,n,t)}},{key:"removeAll",value:function(e){var t=this;void 0===e&&(e=this.storage),Object.keys(e).forEach(function(n){"object"!==_typeof(e[n])||Array.isArray(e[n])?t.remove(n,e):t.removeAll(e[n])})}},{key:"removeGroup",value:function(e){var t=this;this.groups.getValueOf(e,[]).forEach(function(n){var i=[];t.storage.getValueOf(n,[]).map(function(t,n){t.group===e&&i.push(n)}),t.removeEventKeys(n,i)})}},{key:"removeById",value:function(e){var t=[];this.storage.getValueOf(this.ids.getValueOf(e).event,[]).map(function(n,i){e===n.id&&t.push(i)}),this.removeEventKeys(this.ids.getValueOf(e).event,t)}},{key:"find",value:function(e){return this.storage.getValueOf(e,[]).filter(function(t){return t.event===e})}}]),e}(),t=function(){function t(n){_classCallCheck(this,t),this.name=n||"tjs".toUniqueId(),this.listeners=new e,this.pipes=[]}return _createClass(t,[{key:"on",value:function(e,t,n){var i=this;if(!0==e instanceof Array){var a=[];return e.forEach(function(e){a.push(i.listeners.add(e,t,n,!1))}),a}return this.listeners.add(e,t,n,!1)}},{key:"once",value:function(e,t,n){var i=this;if(!0==e instanceof Array){var a=[];return e.forEach(function(e){a.push(i.listeners.add(e,t,n,!0))}),a}return this.listeners.add(e,t,n,!0)}},{key:"emit",value:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];[this].concat(this.pipes).forEach(function(t){t.internalEmit.apply(t,[e].concat(n))})}},{key:"internalEmit",value:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];var a=function(e,t,n,i){return function(){t.active&&t.handler.apply(t,n),t.once&&(t.active=!1)}};this.listeners.find(e).forEach(function(e){setTimeout(a(0,e,n,this.listeners),0)}.bind(this))}},{key:"removeGroupOfListeners",value:function(e){this.listeners.removeGroup(e)}},{key:"removeEventListeners",value:function(e){this.listeners.remove(e)}},{key:"removeAllListeners",value:function(){this.listeners.removeAll()}},{key:"pipe",value:function(e){this.pipes.push(e)}},{key:"removeEventById",value:function(e){this.listeners.removeById(e)}}],[{key:"New",value:function(e){return new t(e)}}]),t}();Object.defineProperty(TJS,"Events",{value:t,enumerable:!1,writable:!1})}(),function(){var e={},t={$eq:"Equals",$regex:"Regex",$notEq:"NotEquals"},n={$limit:"Limit",$sort:"Sort"},i=function(){function t(n){_classCallCheck(this,t),this.namespace=n,this.setValueOf("collections",new Map,!1,{enumerable:!1}),e.setValueOf(n,this)}return _createClass(t,[{key:"collection",value:function(e){return!1===this.collections.has(e)&&this.collections.set(e,a.New(e,this)),this.collections.get(e)}},{key:"loadPersistent",value:function(){this.collections.forEach(function(e){e.loadPersistent()})}}],[{key:"New",value:function(e){return new t(e)}}]),t}(),a=function(){function e(t,n){_classCallCheck(this,e),this.setValueOf("properties",{},!1,{enumerable:!1}),this.setHiddenData("name",t),this.setHiddenData("_items",new Map),this.setHiddenData("_indexes",{}),this.setHiddenData("_parent",n),this.getHiddenData("_indexes").setValueOf("_ensure",[]).push("_id")}return _createClass(e,[{key:"_findPositions",value:function(e){var t=void 0;return t=s.ParseQuery(e),s.ParseStatement(t,this)}},{key:"mapPositions",value:function(e){var t=[],n=void 0;if(n=this.getHiddenData("_items").values(),void 0!==e){var i=!0,a=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var u=o.value;t.push(this.findPosition(u))}}catch(e){a=!0,r=e}finally{try{!i&&s.return&&s.return()}finally{if(a)throw r}}}else{
var l=!0,c=!1,h=void 0;try{for(var d,f=n[Symbol.iterator]();!(l=(d=f.next()).done);l=!0){var p=d.value;t.push(p.data)}}catch(e){c=!0,h=e}finally{try{!l&&f.return&&f.return()}finally{if(c)throw h}}}return t}},{key:"getName",value:function(){return[this.getHiddenData("_parent").namespace,this.getHiddenData("name")].join("::")}},{key:"ensureIndex",value:function(){var e=void 0;e=this.getHiddenData("_indexes._ensure");for(var t=arguments.length,n=Array(t),i=0;i<t;i++)n[i]=arguments[i];return n.forEach(function(t){-1===e.indexOf(t)&&e.push(t)}),this}},{key:"persistent",value:function(){return this.updateValueOf("properties.persistent",!0),this}},{key:"loadPersistent",value:function(){var e=this,t=void 0;return!1!==this.getValueOf("properties.persistent",!1)&&(null!==(t=o.Get(this.getName()))&&void((t=JSON.parse(t))&&t.forEach(function(t){e.insert(t.data)})))}},{key:"all",value:function(){return this.find("all")}},{key:"insert",value:function(e){var t=[];Array.isArray(e)||(e=[e]);var n=!0,i=!1,a=void 0;try{for(var s,u=e[Symbol.iterator]();!(n=(s=u.next()).done);n=!0){var l=s.value,c=void 0,h=void 0;h=this.getHiddenData("_items"),c=r.New(l,this,h.size),h.set(c._id,c),t.push(c)}}catch(e){i=!0,a=e}finally{try{!n&&u.return&&u.return()}finally{if(i)throw a}}return!0===this.getValueOf("properties.persistent",!1)&&(o.Set(this.getName(),JSON.stringify(Array.from(this.getHiddenData("_items").values()))),o.Set(this.getName().dotize("count"),this.getHiddenData("_items").size)),t}},{key:"insertOrDoIfExists",value:function(e,t,n){var i;return i=this.findOne(t),null!==i?(n(),!1):this.insert(e)}},{key:"update",value:function(e,t){var n=void 0,i=void 0,a=[];if(i=this._findPositions(t),0===i.length)return a;n=Array.from(this.getHiddenData("_items").values());var r=!0,s=!1,u=void 0;try{for(var l,c=i[Symbol.iterator]();!(r=(l=c.next()).done);r=!0){var h=l.value;n[h].data.xpand(e,!0),a.push(n[h].data),n[h]._clearHashItem(),n[h]._hashItem()}}catch(e){s=!0,u=e}finally{try{!r&&c.return&&c.return()}finally{if(s)throw u}}return!0===this.getValueOf("properties.persistent",!1)&&(o.Set(this.getName(),JSON.stringify(Array.from(this.getHiddenData("_items").values()))),o.Set(this.getName().dotize("count"),this.getHiddenData("_items").size)),a}},{key:"updateLastItem",value:function(e){var t=void 0;return t=this.findOne(),t?this.update(e,{_id:t._id}):this.insert(e)}},{key:"find",value:function(e){var t=void 0;if(void 0===e)e={};else if("string"==typeof e&&"all"===e)return this.mapPositions();return t=this._findPositions(e),this.mapPositions(t)}},{key:"findOne",value:function(e){var t=void 0;return t=this.find(e),0<t.length?t.shift():null}},{key:"findPosition",value:function(e){var t=void 0;return t=Array.from(this.getHiddenData("_items").values()),void 0===t[e]?null:void 0===t[e].data?null:t[e].data}},{key:"clearLastItem",value:function(){var e=void 0;(e=this.findOne())&&this.remove({_id:e._id})}},{key:"remove",value:function(e){var t=void 0,n=void 0,i=[];if(n=this._findPositions(e),0===n.length)return i;t=Array.from(this.getHiddenData("_items").values());var a=!0,r=!1,s=void 0;try{for(var u,l=n[Symbol.iterator]();!(a=(u=l.next()).done);a=!0){var c=u.value;i.push(t[c].data),t[c]._clearHashItem(),this.getHiddenData("_items").delete(t[c]._id)}}catch(e){r=!0,s=e}finally{try{!a&&l.return&&l.return()}finally{if(r)throw s}}return!0===this.getValueOf("properties.persistent",!1)&&(o.Set(this.getName(),JSON.stringify(Array.from(this.getHiddenData("_items").values()))),o.Set(this.getName().dotize("count"),this.getHiddenData("_items").size)),i}}],[{key:"New",value:function(t,n){return new e(t,n)}}]),e}(),r=function(){function e(t,n,i){_classCallCheck(this,e),this._id="tjs".toUniqueId(16),this.position=i,this.parent=n,this.data=t,this.data.xpand({_id:this._id}),this.hashData={},this._hashItem()}return _createClass(e,[{key:"get",value:function(e){return this.data.getValueOf(e,null)}},{key:"set",value:function(e,t){return this.data.updateValueOf(e,t)}},{key:"_hashItem",value:function(){var e=void 0;e=this.parent.getHiddenData("_indexes._ensure");var t=!0,n=!1,i=void 0;try{for(var a,r=e[Symbol.iterator]();!(t=(a=r.next()).done);t=!0){var o=a.value,s=void 0,u=void 0,l=void 0;if("object"===_typeof(this.get(o)))return!1;l=this.parent.getHiddenData("_indexes").setValueOf(o,{}),u=this.get(o).toString().replace(/\.|_|-|;|\s/g,":"),s=l.setValueOf(u,[]),-1===s.indexOf(this.position)&&s.push(this.position),this.hashData[o.dotize(u)]=this.position}}catch(e){n=!0,i=e}finally{try{!t&&r.return&&r.return()}finally{if(n)throw i}}}},{key:"_clearHashItem",value:function(){var e=this,t=void 0;t=this.hashData,Object.keys(t).forEach(function(n){var i=void 0;if(i=e.parent.getValueOf("_hiddenData._indexes".dotize(n)),!1===Array.isArray(i))return!1;i.splice(i.indexOf(t[n]),1),e.updateValueOf("_hiddenData._indexes".dotize(n),i)}),this.hashData={}}},{key:"getDataItemValue",value:function(e){var t=this,n=void 0,i=void 0,a=[];if(null===(n=this.get(e))){i=e.split(".");for(var r in i)if(!0===i.hasOwnProperty(r)){var o=void 0;if(a.push(i[r]),o=a.join("."),null===this.get(o))return null;if(!0===Array.isArray(this.get(o))){var s=function(){var i=void 0;return void 0===(i=e.split(o+".").pop())||""===i?{v:null}:(n=t.get(o).filter(function(e){return void 0!==e.getValueOf(i)}),{v:n})}();if("object"===(void 0===s?"undefined":_typeof(s)))return s.v}return _typeof(this.get(o)),this.get(a.join("."))}}return n}}],[{key:"New",value:function(t,n,i){return new e(t,n,i)}}]),e}(),o=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"Get",value:function(e){return window.localStorage.getItem(e)}},{key:"Set",value:function(e,t){window.localStorage.setItem(e,t)}},{key:"Remove",value:function(e){window.localStorage.removeItem(item)}}]),e}(),s=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"ParseQuery",value:function(e){var i={};return Object.keys(e).forEach(function(a){var r={parts:[],method:"Equals",value:e[a]};"object"===_typeof(e[a])&&!1===Array.isArray(e[a])&&(0===a.indexOf("$")?(void 0!==n[a]&&(r.method=n[a]),r.value=e[a]):Object.keys(e[a]).forEach(function(n){void 0!==t[n]?r.method=t[n]:r.parts.push(n),r.value=e[a][n]})),i[a]=r}),i}},{key:"ParseStatement",value:function(e,t){var n=[];return Object.keys(e).forEach(function(i){var a=void 0,r=void 0,o=void 0;if(o=e[i].method,"function"!=typeof l[o])return!1;a=-1!==t.getHiddenData("_indexes._ensure").indexOf(i),r=l[o](t,i,e[i].value,a),n=0===n.length?[].concat(r):intersectArrays(n,r)}),Object.keys(e).forEach(function(i){var a=void 0;if(a=e[i].method,"function"!=typeof u[a])return!1;0===n.length&&(n=Object.keys(Array.from(t.getHiddenData("_items")))),n=u[a](t,n,e[i].value)}),0===Object.keys(e).length?Object.keys(Array.from(t.getHiddenData("_items"))):n}}]),e}(),u=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"Limit",value:function(e,t,n){return t.splice(n.start,n.count)}},{key:"Sort",value:function(e,t,n){var i=void 0,a=void 0,r=[],o=[];switch(a=e.mapPositions(t),t.forEach(function(e,t){r[a[t]._id]=e}),n.way.toUpperCase()){case"ASC":i=n.by;break;case"DESC":i="-"+n.by}return a.sortBy(i),a.forEach(function(e,t){o.push(r[a[t]._id])}),o}}]),e}(),l=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"Equals",value:function(e,t,n,i){var a=[],r=void 0;if(!0===i){var o=void 0;return o=n.toString().replace(/\.|_|-|;|\s/g,":"),e.getHiddenData("_indexes").getValueOf(t,{}).getValueOf(o,[])}return r=e.getHiddenData("_items"),r.forEach(function(e){var i=void 0;i=e.getDataItemValue(t),!0===Array.isArray(i)&&i.forEach(function(i){var r=void 0;r=t.split(".").pop(),i[r]===n&&a.push(e.position)}),i===n&&a.push(e.position)}),a}},{key:"NotEquals",value:function(e,t,n,i){var a=[],r=void 0;if(!0===i){var o=void 0;return o=n.toString().replace(/\.|_|-|;|\s/g,":"),r=e.getHiddenData("_indexes").getValueOf(t,{}),Object.keys(r).forEach(function(e){e!==o&&(a=a.concat(r[e]))}),a}return r=e.getHiddenData("_items"),r.forEach(function(e){var i=void 0;i=e.getDataItemValue(t),!0===Array.isArray(i)&&i.forEach(function(i){var r=void 0;r=t.split(".").pop(),i[r]!==n&&a.push(e.position)}),i!==n&&a.push(e.position)}),a}},{key:"Regex",value:function(e,t,n,i){var a=[],r=void 0;if(!0===i){var o=void 0;return o=n.toString().replace(/\.|_|-|;|\s/g,":"),r=e.getHiddenData("_indexes").getValueOf(t,{}),Object.keys(r).forEach(function(e){o.test(e)&&(a=a.concat(r[e]))}),a}return r=e.getHiddenData("_items"),r.forEach(function(e){var i=void 0;i=e.getDataItemValue(t),!0===Array.isArray(i)&&i.forEach(function(i){var r=void 0;r=t.split(".").pop(),!0===n.test(i[r])&&a.push(e.position)}),!0===n.test(i)&&a.push(e.position)}),a}}]),e}();Object.defineProperty(TJS,"SimpleDb",{value:i,enumerable:!1,writable:!1})}();var BaseValidator=function e(t){_classCallCheck(this,e),this.option=t},ValidateMin=function(e){function t(e){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return _inherits(t,e),_createClass(t,[{key:"run",value:function(e){return"string"==typeof e?this.option<=e.length||"below_min":this.option<=e||"below_min"}}],[{key:"New",value:function(e){return new t(e)}}]),t}(BaseValidator),ValidateMax=function(e){function t(e){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return _inherits(t,e),_createClass(t,[{key:"run",value:function(e){return"string"==typeof e?this.option>=e.length||"max_exceeded":this.option>=e||"max_exceeded"}}],[{key:"New",value:function(e){return new t(e)}}]),t}(BaseValidator),ValidateLength=function(e){function t(e){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return _inherits(t,e),_createClass(t,[{key:"run",value:function(e){return"string"==typeof e?this.option===e.length||"length_mismatch":this.option===e||"length_mismatch"}}],[{key:"New",value:function(e){return new t(e)}}]),t}(BaseValidator),ValidateRequired=function(e){function t(e){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return _inherits(t,e),_createClass(t,[{key:"run",value:function(e){return"string"==typeof e?0!==e.length||"required":0!==e||"required"}}],[{key:"New",value:function(e){return new t(e)}}]),t}(BaseValidator);!function(){var e={max:ValidateMax,min:ValidateMin,length:ValidateLength,required:ValidateRequired},t=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"Load",value:function(e){var t=[];if(Array.isArray(e)){var i=!0,a=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var u=o.value;if("object"===(void 0===u?"undefined":_typeof(u))){var l=Object.keys(u)[0];u=n.New(l,u[l])}t.push(u)}}catch(e){a=!0,r=e}finally{try{!i&&s.return&&s.return()}finally{if(a)throw r}}}return t}}]),e}(),n=function(){function t(e,n){_classCallCheck(this,t),this.name=e,this.options=n}return _createClass(t,[{key:"load",value:function(){var t=void 0;if(void 0===(t=e[this.name]))throw new Error("[Validator] Unknown validator [%s]".sprintf(this.name));return t=t.New(this.options),t.run.bind(t)}}],[{key:"New",value:function(e,n){return new t(e,n).load()}}]),t}();Object.defineProperty(TJS,"Validator",{value:t,enumerable:!1,writable:!1})}();var BaseStructure=function(){function e(t){_classCallCheck(this,e),this._type=String,this._structure=void 0,this.option=t,void 0===this.option&&(this.option="default"),this.option=this.option.toLowerCase()}return _createClass(e,[{key:"build",value:function(){return{structure:this._structure,type:this._type}}}]),e}(),StructureArray=function(e){function t(e){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n._type=Array,n._default="_Any",n.parseOptions(),n}return _inherits(t,e),_createClass(t,[{key:"parseOptions",value:function(){}}],[{key:"New",value:function(e){return new t(e).build()}}]),t}(BaseStructure),StructureBoolean=function(e){function t(e){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n._type=Boolean,n._default="_Any",n.parseOptions(),n}return _inherits(t,e),_createClass(t,[{key:"parseOptions",value:function(){switch(this.option){case"default":this._structure=this[this._default].call(this);break;default:"function"==typeof this.option&&(this._structure=this.option.call(this))}}},{key:"_Any",value:function(){return/^true|false|1|0$/}}],[{key:"New",value:function(e){return new t(e).build()}}]),t}(BaseStructure),StructureClock=function(e){function t(e){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n._default="_HoursMinutes",n.parseOptions(),n}return _inherits(t,e),_createClass(t,[{key:"parseOptions",value:function(){switch(this.option){case"default":this._structure=this[this._default].call(this);break;case"timestamp":this._type=Number,this._structure=this._Timestamp.call(this);break;case"hh:mm":this._structure=this._HoursMinutes.call(this);break;case"hh:mm:ss":this._structure=this._HoursMinutesSeconds.call(this);break;case"hh:mm:ss.mmm":this._structure=this._HoursMinutesSecondsMilliseconds.call(this);break;default:"function"==typeof this.option&&(this._structure=this.option.call(this))}}},{key:"_Timestamp",value:function(){return/^[0-9]{13}$/}},{key:"_HoursMinutes",value:function(){return/^[0-9]{2}\:[0-9]{2}$/}},{key:"_HoursMinutesSeconds",value:function(){return/^[0-9]{2}\:[0-9]{2}\:[0-9]{2}$/}},{key:"_HoursMinutesSecondsMilliseconds",value:function(){return/^[0-9]{2}\:[0-9]{2}\:[0-9]{2}\.[0-9]+$/}}],[{key:"New",value:function(e){return new t(e).build()}}]),t}(BaseStructure),StructureEmail=function(e){function t(e){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n._default="_Any",n.parseOptions(),n}return _inherits(t,e),_createClass(t,[{key:"parseOptions",value:function(){switch(this.option){case"default":this._structure=this[this._default].call(this);break;default:"function"==typeof this.option&&(this._structure=this.option.call(this))}}},{key:"_Any",value:function(){return/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/}}],[{key:"New",value:function(e){return new t(e).build()}}]),t}(BaseStructure),StructureString=function(e){function t(e){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n._default="_All",n.parseOptions(),n}return _inherits(t,e),_createClass(t,[{key:"parseOptions",value:function(){switch(this.option){case"default":this._structure=this[this._default].call(this);break;case"any":this._structure=this._All.call(this);break;case"alphanumeric":this._structure=this._AlphaNumeric.call(this);break;case"letters":this._structure=this._LettersOnly.call(this);break;case"numbers":this._structure=this._NumbersOnly.call(this);break;default:"function"==typeof this.option&&(this._structure=this.option.call(this))}}},{key:"_All",value:function(){return/(.*?)/}},{key:"_AlphaNumeric",value:function(){return/^[a-zA-Z0-9]*$/}},{key:"_LettersOnly",value:function(){return/^[a-zA-Z]*$/}},{key:"_NumbersOnly",value:function(){return/^[0-9]*$/}}],[{key:"New",value:function(e){return new t(e).build()}}]),t}(BaseStructure),StructureNumber=function(e){function t(e){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n._type=Number,n._default="_Any",n.parseOptions(),n}return _inherits(t,e),_createClass(t,[{key:"parseOptions",value:function(){switch(this.option){case"default":this._structure=this[this._default].call(this);break;default:"function"==typeof this.option&&(this._structure=this.option.call(this))}}},{key:"_Any",value:function(){return/^[0-9]*$/}}],[{key:"New",value:function(e){return new t(e).build()}}]),t}(BaseStructure),StructureObject=function(e){function t(e){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n._type=Object,n._default="_Any",n.parseOptions(),n}return _inherits(t,e),_createClass(t,[{key:"parseOptions",value:function(){}}],[{key:"New",value:function(e){return new t(e).build()}}]),t}(BaseStructure);!function(){var e={Array:StructureArray,Boolean:StructureBoolean,String:StructureString,Number:StructureNumber,Object:StructureObject,Clock:StructureClock,Email:StructureEmail},t={};t.setSchema({type:void 0,structure:"default",middleware:[],required:!0,value:void 0});var n=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"New",value:function(e,t){return a.New(e,t)}},{key:"Use",value:function(e,t){return i.New(e,t)}}]),e}(),i=function(){function n(e,i){_classCallCheck(this,n),this.name=e,this.options=t.createNewItem(i),this.data={},this.parseOptions()}return _createClass(n,[{key:"parseOptions",value:function(){var n=void 0;if(!1===(n=e.getValueOf(this.name,!1)))throw new Error("[Structure] Unknown structure [%s]".sprintf(this.name));if(void 0!==n.isCustom&&!0===n.isCustom)this.data=t.createNewItem(n);else{var i=void 0;if(i=n.New(this.options.structure||"default"),Object.assign(this.data,this.options),Object.assign(this.data,i),this.data=t.createNewItem(this.data),0<this.data.middleware.length){var a=void 0;a=TJS.Validator.Load(this.data.middleware),this.data.middleware=a}}}},{key:"build",value:function(){return this.data}}],[{key:"New",value:function(e,t){return new n(e,t).build()}}]),n}(),a=function(){function n(e,t){_classCallCheck(this,n),this.name=e,this.options=t,this.options=Object.assign({isCustom:!0},this.options),this.parseStructure(),this.build()}return _createClass(n,[{key:"parseStructure",value:function(){if(void 0===this.options.type)throw new Error("[Structure] CustomStructure type not specified");if(void 0!==this.options.structure&&!1==this.options.structure instanceof RegExp)throw new Error("[Structure] CustomStructure structure must be a RegExp");if(void 0!==this.options.middleware&&!1===Array.isArray(this.options.middleware))throw new Error("[Structure] CustomStructure middleware container must be an array");if(void 0!==this.options.middleware){var e=!0,t=!1,n=void 0;try{for(var i,a=this.options.middleware[Symbol.iterator]();!(e=(i=a.next()).done);e=!0){var r=i.value;if("function"!=typeof r&&"object"!==(void 0===r?"undefined":_typeof(r)))throw new Error("[Structure] CustomStructure middleware type must be a function")}}catch(e){t=!0,n=e}finally{try{!e&&a.return&&a.return()}finally{if(t)throw n}}}}},{key:"build",value:function(){var n=t.createNewItem(this.options);if(!1===e.getValueOf(this.name,!1)&&0<n.middleware.length){var i=[];i=[].concat(i,TJS.Validator.Load(n.middleware)),n.middleware=i}e.setValueOf(this.name,n)}}],[{key:"New",value:function(e,t){return new n(e,t)}}]),n}();Object.defineProperty(TJS,"Structure",{value:n,enumerable:!1,writable:!1})}();var Loader=function(){function e(){_classCallCheck(this,e),this.config=TJS.Config}return _createClass(e,[{key:"getJsModulePath",value:function(e){return[this.config.get("modules.path"),e,"module.js"].join("/")}},{key:"getHtmlModulePath",value:function(e){return[this.config.get("modules.path"),e,"module.html"].join("/")}},{key:"getModuleComponentPath",value:function(e,t){return-1!==t.indexOf("::")?this.getModuleNamespaceComponentPath(e,t):[this.config.get("modules.path"),e,"components",t+".js"].join("/")}},{key:"getModuleNamespaceComponentPath",value:function(e,t){var n;n=t.split("::");var i=n.shift();return t=n.shift(),[this.config.get("modules.path"),e,"components",i.replace(/\./g,"/"),t+".js"].join("/")}},{key:"getModule",value:function(e){var t=void 0,n=void 0;n=document.createElement("div"),n.setAttribute("id","tjs2016".toUniqueId()),n.setAttribute("hidden",""),t=document.createElement("script"),t.type="text/javascript",t.src=this.getJsModulePath(e),t.onload=function(e){t.parentNode.removeChild(t)},document.head.appendChild(t),this.load(e,n,function(){})}},{key:"getComponent",value:function(e,t){var n=void 0;n=document.createElement("script"),n.type="text/javascript",n.src=this.getModuleComponentPath(e,t),n.onload=function(e){n.parentNode.removeChild(n)},document.body.appendChild(n)}},{key:"load",value:function(e,t,n){if(this.config.has("modules.html"))return!1;var i=new XMLHttpRequest;i.open("GET",this.getHtmlModulePath(e),!0),i.onload=function(a){if(4===i.readyState){if(200!==i.status)throw new Error("Could not fetch template data for %s".sprintf(path));"function"==typeof n&&n(),t.insertAdjacentHTML("afterbegin",i.responseText),document.body.insertBefore(t,document.body.lastChild),DOMHelper.parseTemplates(e,t)}},i.onerror=function(e){throw e},i.send()}},{key:"initialize",value:function(){this.config.has("modules.html")&&Array.from(TJS.dom.getAll("[data-module]",TJS.dom.get("#"+this.config.get("modules.html")))).forEach(function(e){DOMHelper.parseTemplates(e.getAttribute("data-module"),e)})}}],[{key:"New",value:function(){return new e}}]),e}();!function(){var e={},t=function(){function e(t){_classCallCheck(this,e),this.parent=t,this.system=TJS.SimpleDb.New("system"),this.id="tjs".toUniqueId(16),this.messageBagSchema={},this.messageBagSchema.setSchema({status:!0,data:{}}),this.messageBag=this.messageBagSchema.createNewItem(),this.state=this.system.collection("state"),this.stateTempJar=this.system.collection("temp"),this.state.insert({id:this.id}),this.logs=this.system.collection("logs"),this.history=this.system.collection("history"),this.rules=this.system.collection("rules"),this.protoItems=this.system.collection("protoItems"),this.rules.ensureIndex(["name"]),this.protoItems.ensureIndex(["name"]),this.moments={}}return _createClass(e,[{key:"resetMessageBag",value:function(){this.messageBag=this.messageBagSchema.createNewItem()}},{key:"createNewMessageBag",value:function(){return this.messageBagSchema.createNewItem()}},{key:"checkMessageBagStatus",value:function(e){return e||(e=this.messageBag),!0===e.status}},{key:"addKey",value:function(e,t){this.addKeyDefinition(e,t),this.extractValue(e,t)}},{key:"addKeyDefinition",value:function(e,t){this.rules.insertOrDoIfExists(t.xpand({name:e},!0).deepClone(),{name:e},function(){return!1}),this.extractProtoKeys(e,t.deepClone())}},{key:"extractProtoKeys",value:function(e,t){var n=this;if(t.getValueOf("contract",!1)){var i=this.getProtoItem(t.getValueOf("contract"));Object===t.getValueOf("type")&&Object.keys(i).forEach(function(t){n.addKeyDefinition(e.dotize(t),i.getValueOf(t))})}}},{key:"addDefinition",value:function(e,t){this.protoItems.insertOrDoIfExists({name:e,definition:t},{name:e},function(){throw new Error("Definition for %s already exists".sprintf(e))})}},{key:"extractValue",value:function(e,t){var n=void 0;switch(void 0===t?"undefined":_typeof(t)){case"object":!0===t.hasOwnProperty("value")&&(n=t.value);break;default:n=description}n&&this.setKeyValue(e,n)}},{key:"getKeyRulesDescriptor",value:function(e){return this.rules.findOne({name:e})}},{key:"getProtoItem",value:function(e){var t=this.protoItems.findOne({name:e});if(null===t)throw new Error("A contract definition called '%s' was requested but not found".sprintf(e));return t.getValueOf("definition",{})}},{key:"evaluateValue",value:function(t,n,i,a){var r=e.validateValueDescriptor(i,this.getState().getValueOf(t,null),n);a.updateValueOf("data.key",t),!0!==r&&(a.status=!1,!1===r?a.updateValueOf("data.error","middleware_returned_false"):a.updateValueOf("data.error",r)),this.checkMessageBagStatus(a)&&this.evaluateArrayValue(t,n,i,a),this.checkMessageBagStatus(a)&&this.evaluateObjectValue(t,n,i,a)}},{key:"evaluateArrayValue",value:function(e,t,n,i){var a=this;if(!Array.isArray(t))return!0;i.updateValueOf("data.key",e),t.forEach(function(t,r){if(!a.checkMessageBagStatus(i))return!1;i.updateValueOf("data.item.index",r),a.evaluateObjectValue(e,t,n,i)})}},{key:"evaluateObjectValue",value:function(e,t,n,i){return"object"!==(void 0===t?"undefined":_typeof(t))||(!!Array.isArray(t)||(i.updateValueOf("data.key",e),void this.evaluateProtoItem(n,t,i)))}},{key:"evaluateProtoItem",value:function(e,t,n){var i=void 0;if("object"!==(void 0===e?"undefined":_typeof(e))||!e.getValueOf("contract",!1))return!0;i=this.getProtoItem(e.getValueOf("contract")),this.validateProtoItemValue(i,t,n)}},{key:"validateProtoItemValue",value:function(e,t,n){var i=this,a={},r={},o=void 0;Object.keys(e).forEach(function(t){!0===e.getValueOf(t.dotize("required"),!0)&&r.setValueOf(t,e.getValueOf(t.dotize("value"),null))}),a.setSchema(r),o=a.createNewItem(t),Object.keys(e).forEach(function(t){var a=void 0;a=i.createNewMessageBag(),i.evaluateValue(n.getValueOf("data.key").dotize(t),o.getValueOf(t),e.getValueOf(t),a),i.checkMessageBagStatus(a)||(n.status=!1,n.setValueOf("data.item.errors",[]).push(a.getValueOf("data")))}),this.checkMessageBagStatus(n)&&Object.keys(o).forEach(function(e){t.setValueOf(e,o.getValueOf(e))})}},{key:"pushToKey",value:function(e,t){return Array.isArray(t)||(t=[t]),this.setKeyValue(e,t,!0)}},{key:"setKeyValue",value:function(e,t,n,i){var a=this,r=this.getState().softClone(),o=void 0;if(!(o=this.getKeyRulesDescriptor(e)))throw new Error("State object key %s has no description. Cannot set the key if it wasn't defined earlier in the process".sprintf(e));if(void 0===i&&(i=!0),this.resetMessageBag(),this.evaluateValue(e,t,o,this.messageBag),!this.checkMessageBagStatus())return this.emitErrorsOnKey(e,this.messageBag),!1;var s=r.getValueOf(e,null);if(n?(r.updateValueOf(e,r.getValueOf(e).concat(t)),this.saveState(r),this.emitEventOnKey(e,"push",t,this.getState().getValueOf(e),r),this.emitValueChange(e,t,s,r)):(r.updateValueOf(e,t),this.saveState(r),i&&(this.recursivelyEmitChange(t,s,r,e),"object"!==(void 0===t?"undefined":_typeof(t))||Array.isArray(t)||this.emitValueChange(e,t,s,r))),this.recursivelyProcessMoments(e,r.getValueOf(e,null)),i){var u=e.split(".");if(1===u.length)return!0;e.split(".").forEach(function(){var e=void 0;u.pop(),0<u.length&&(e=u.join("."),a.emitValueChange(e,r.getValueOf(e,null),{},r))})}i||n||this.emitEventOnKey(e,"foundAndUpdate",t,this.getState().getValueOf(e),r)}},{key:"removePositionsFromArray",value:function(e,t){var n=this.getState().softClone();if(!this.getKeyRulesDescriptor(e))throw new Error("State object key %s has no description. Cannot set the key if it wasn't defined earlier in the process".sprintf(e));if("number"==typeof t&&(t=[t]),!Array.isArray(t))throw new Error("Removing positions from state object key %s needs an array as positions".sprintf(e));var i=n.getValueOf(e),a=i.softClone();if(!Array.isArray(n.getValueOf(e)))throw new Error("State object key %s is not an array. Cannot remove an item from a non-array key".sprintf(e));t.forEach(function(e){i.splice(e,1)}),n.updateValueOf(e,i),this.saveState(n),this.recursivelyEmitChange(i,a,this.getState().softClone(),e)}},{key:"updateWhere",value:function(e,t,n){var i=this.getState().softClone(),a=void 0;if(!this.getKeyRulesDescriptor(e))throw new Error("State object key %s has no description. Cannot set the key if it wasn't defined earlier in the process".sprintf(e));if(a=i.getValueOf(e),!Array.isArray(a))throw new Error("State object key %s is not an array. Cannot remove an item from a non-array key".sprintf(e));return"object"!==(void 0===n?"undefined":_typeof(n))||Array.isArray(n)?[]:(this.stateTempJar.remove({}),this.stateTempJar.insert(a),this.stateTempJar.update(t,n),this.setKeyValue(e,this.stateTempJar.find(),!1,!1))}},{key:"findItem",value:function(e,t){var n=this.findItems(e,t);return 0!==n.length&&n[0]}},{key:"findItems",value:function(e,t){var n=this.findPositionsInArray(e,t),i=this.getState().softClone(),a=[];return n.forEach(function(t){a.push(i.getValueOf(e,[])[t])}),a}},{key:"findPositionsInArray",value:function(e,t){var n=this.getState().softClone(),i=void 0;if(!this.getKeyRulesDescriptor(e))throw new Error("State object key %s has no description. Cannot set the key if it wasn't defined earlier in the process".sprintf(e));if(i=n.getValueOf(e),!Array.isArray(i))throw new Error("State object key %s is not an array. Cannot remove an item from a non-array key".sprintf(e));return"object"!==(void 0===t?"undefined":_typeof(t))||Array.isArray(t)?[]:(this.stateTempJar.remove({}),this.stateTempJar.insert(i),this.stateTempJar._findPositions(t))}},{key:"unsetKey",value:function(e){var t=this.getState().softClone(),n=t.getValueOf(e,null);t.unsetValueOf(e),this.saveState(t),this.emitValueRemoval(e,n,t)}},{key:"emitErrorsOnKey",value:function(e,t){var n=this;console.warn("TJS::StateObject:error",e,t.data),this.emitEventOnKey(e,"error",t.data),t.data.getValueOf("item.errors",[]).forEach(function(e){n.emitErrorsOnKey(e.key,{data:e})})}},{key:"recursivelyProcessMoments",value:function(e,t){var n=this;if(null===t)return!1;"object"!==(void 0===t?"undefined":_typeof(t))||Array.isArray(t)?Array.isArray(t)?this.processMoments(e.replace(".length",""),t.length):this.processMoments(e,t):Object.keys(t).forEach(function(i){n.recursivelyProcessMoments(e.dotize(i),t.getValueOf(i))})}},{key:"recursivelyEmitChange",value:function(e,t,n,i){var a=this;if(null===e)return!1;"object"!==(void 0===e?"undefined":_typeof(e))||Array.isArray(e)?this.emitValueChange(i,e,t,n):(null!==t&&void 0!==t||(t={}),Object.keys(e).forEach(function(r){a.recursivelyEmitChange(e.getValueOf(r),t.getValueOf(r),n,i.dotize(r))}))}},{key:"emitValueChange",value:function(e,t,n,i){void 0!==n&&null!==n?this.emitEventOnKey(e,"update",t,n,i):this.emitEventOnKey(e,"set",t,i),this.emitEventOnKey(e,"change",t,i)}},{key:"emitValueRemoval",value:function(e,t,n){this.emitEventOnKey(e,"remove",t,n)}},{key:"addMoment",value:function(e,t,n,i){this.moments.setValueOf(e,[]).push({operation:t,expected:n,callback:i})}},{key:"emitKeyEvent",value:function(e,t){for(var n=arguments.length,i=Array(n>2?n-2:0),a=2;a<n;a++)i[a-2]=arguments[a];this.parent.emit.apply(this.parent,[[e,t].join(":")].concat(i))}},{key:"emitEventOnKey",value:function(e,t){for(var n=arguments.length,i=Array(n>2?n-2:0),a=2;a<n;a++)i[a-2]=arguments[a];this.parent.emit.apply(this.parent,[t,e].concat(i)),this.emitKeyEvent.apply(this,[e,t].concat(i))}},{key:"processMoments",value:function(e,t){this.moments.getValueOf(e,[]).filter(function(e){switch(e.operation){case"=":return e.expected===t;case">":return e.expected>t;case"<":return e.expected<t}}).forEach(function(e){e.callback(t)})}},{key:"getState",value:function(){return this.state.findOne({id:this.id})}},{key:"saveState",value:function(e){var t=this.getState();this.history.insert(this.getState()),this.state.remove({id:this.id}),this.state.insert(e),this.emitEventOnKey("state","change",e,t)}}],[{key:"validateValueDescriptor",value:function(t,n,i){var a=!0;return!t||(void 0===i&&!0===(a=e.handleRequired(t))||(!0===a&&(a=e.handleValueType(t,i)),!0===a&&(a=e.handleValueStructure(t,i)),!0===a&&(a=e.handleValueMiddleware(t,n,i)),a))}},{key:"handleValueStructure",value:function(e,t){return!e.getValueOf("structure",!1)||(!(!0!=e.getValueOf("structure")instanceof RegExp||!e.getValueOf("structure").test(t))||"incorrect_structure")}},{key:"handleRequired",value:function(e){return!e.getValueOf("required",!0)||"required"}},{key:"handleValueMiddleware",value:function(e,t,n){var i=!0;return e.getValueOf("middleware",!1)&&e.getValueOf("middleware",[]).forEach(function(e){if(!0!==i)return!1;i=e(n,t)}),i}},{key:"handleValueType",value:function(e,t){var n=!0,i=void 0;switch(e.getValueOf("type",!1)){case Array:n=Array.isArray(t),i="not_array";break;case String:n="string"==typeof t,i="not_string";break;case Number:n="number"==typeof t,i="not_number";break;case Object:n="object"===(void 0===t?"undefined":_typeof(t))&&!Array.isArray(t),i="not_object";break;case Boolean:n=!0===t||!1===t,i="not_boolean"}
return!0!==n?i:n}}]),e}(),n=function(n){function i(){_classCallCheck(this,i);var e=_possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return e.handler=new t(e),e}return _inherits(i,n),_createClass(i,[{key:"defineContract",value:function(e,t){this.handler.addDefinition(e,t)}},{key:"defineKey",value:function(e,t){this.handler.addKeyDefinition(e,t)}},{key:"add",value:function(e,t){this.handler.addKey(e,t)}},{key:"set",value:function(e,t){this.handler.setKeyValue(e,t)}},{key:"unset",value:function(e){this.handler.unsetKey(e)}},{key:"get",value:function(e){return this.getSnapshot().getValueOf(e)}},{key:"push",value:function(e,t){return this.handler.pushToKey(e,t)}},{key:"findItems",value:function(e,t){return this.handler.findItems(e,t)}},{key:"findItem",value:function(e,t){return this.handler.findItem(e,t)}},{key:"findItemsPositions",value:function(e,t){return this.handler.findPositionsInArray(e,t)}},{key:"removeItems",value:function(e,t){return this.handler.removePositionsFromArray(e,t)}},{key:"findAndUpdate",value:function(e,t,n){return this.handler.updateWhere(e,t,n)}},{key:"when",value:function(e,t,n,i){return this.handler.addMoment(e,t,n,i)}},{key:"getSnapshot",value:function(){return this.handler.getState()}}],[{key:"New",value:function(t){return e.setValueOf(t,new i)}},{key:"getInstance",value:function(t){return e.getValueOf(t,function(){throw new Error("A state object instance has been requested but it doesn't exist: %s".sprintf(t))})}}]),i}(TJS.Events);Object.defineProperty(TJS,"ApplicationState",{value:n,enumerable:!1,writable:!1})}(),function(){var e=void 0,t={},n=void 0,i={},a=[],r=function(){function e(n){_classCallCheck(this,e),this.module=n,this.instances={},t.getValueOf(n.getName()).addToPipe(this.getSandbox().instance)}return _createClass(e,[{key:"getSandbox",value:function(){return this.module.handler.getModuleSandbox(this.module.getName())}},{key:"use",value:function(e){this.getSandbox().setValueOf("componentsQueue",[]).push(e)}},{key:"on",value:function(e,t){this.getSandbox().instance.on.apply(this.getSandbox().instance,[e,t.bind(this)])}},{key:"once",value:function(e,t){return this.getSandbox().instance.once(e,function(){t.apply(this,arguments)})}},{key:"emit",value:function(){return this.getSandbox().instance.emit.apply(this.getSandbox().instance,arguments)}},{key:"newInstance",value:function(e){if(void 0===this.module.getComponentPrototype(e))throw new Error("Calling a new instance on a non-existent component: %s::%s".sprintf(this.module.getName(),e));return new(this.module.getComponentPrototype(e))}},{key:"singleInstance",value:function(e){return this.setValueOf("instances".dotize(e),this.newInstance(e))}}]),e}(),o=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};_classCallCheck(this,t);var i=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.moduleName=e,i.container=null,i.stateobject=null,i.renderQueue=[],i.isReady=!1,i.options=n,i}return _inherits(t,e),_createClass(t,[{key:"addToPipe",value:function(e){-1===this.pipes.indexOf(e)&&this.pipe(e)}},{key:"render",value:function(){var e={},t=void 0,n=void 0;Array.from(arguments).forEach(function(t){return!0==t instanceof HTMLElement?e.updateValueOf("container",t):"string"==typeof t?e.updateValueOf("section",t):"object"===(void 0===t?"undefined":_typeof(t))?e.updateValueOf("data",t):void 0}),t=e.getValueOf("data"),n=e.getValueOf("container");var i="render";if(e.getValueOf("section")&&(i=[e.section,"render"].join(":")),!e.getValueOf("data")){if(this.stateObject||(this.stateObject=TJS.Config.has("application.state")?TJS.Config.get("application.state"):null),void 0===this.stateObject||null===this.stateObject)throw new Error("Module %s has called a render without any data supplied".sprintf(this.moduleName));t=this.stateObject.getSnapshot()}e.getValueOf("container")||(n=this.container),this.isReady?this.emit(i,t,n):this.renderQueue.push([i,t,n])}},{key:"setContainer",value:function(e){"string"==typeof e&&(e=TJS.dom.getContainer(e)),this.container=e}},{key:"setStateObject",value:function(e){if("function"!=typeof e.getSnapshot)throw new Error("Invalid state object supplied to module %s".sprintf(this.moduleName));this.stateobject=e}}]),t}(TJS.Events),s=function(){function n(){_classCallCheck(this,n),this.modules={},this.modulesTemplates={},this.moduleSandbox={},this.componentExtensionsQueue=[],this.moduleSandbox.setSchema({isInstalled:!1,componentsQueue:[],body:{},components:{},isReady:!1,instance:{}}),this.loader=new Loader}return _createClass(n,[{key:"build",value:function(e){if(!this.isInstalled(e.getName())&&e.getBody())return this.getModuleSandbox(e.getName()).updateValueOf("body",e.getBody()),this.getModuleSandbox(e.getName()).instance=e,this.installModule(e),!0}},{key:"installModule",value:function(e){this.getModuleSandbox(e.getName()).getValueOf("body",function(){throw new Error("Module %s body is not callable".sprintf(e.getName()))})(n.getModuleSandboxFacade(e),t.getValueOf(e.getName()).options),this.getModuleSandbox(e.getName()).isInstalled=!0,e.pipe(t.getValueOf(e.getName())),e.emit.apply(e,["install.complete",this.getModuleSandbox(e.getName())]),this.installModuleComponents(e)}},{key:"installModuleComponents",value:function(e){var t=this;this.getModuleSandbox(e.getName()).componentsQueue.forEach(function(n){t.loader.getComponent(e.getName(),n)})}},{key:"logicalComponentExtension",value:function(e,t){var n=void 0,i=e,a=void 0,r=void 0;if(!t.getValueOf("prototype.extend"))return t;if(n=t.prototype.extend,a=t.prototype.extend,-1!==n.indexOf("@")){var o=n.split("@");i=o.shift(),a=o.shift()}if(null===(r=this.getModuleSandbox(i).getValueOf("components".dotize(a),null)))throw new Error("%s tried to extend itself using %s but the component does not exist".sprintf(t.prototype.name,t.prototype.extend));return t.prototype.xpand(r.prototype.deepClone()),!0===t.prototype.abstract&&(t.prototype.abstract=!1),t}},{key:"addComponent",value:function(e,n,i){var a=this,r=void 0;i.name=n,i.moduleName=e.getName(),r=c.extend(i),this.componentExtensionsQueue.push({module:e,extension:r}),r.getValueOf("prototype.namespace")&&(n=[r.getValueOf("prototype.namespace"),n].join("::")),this.getModuleSandbox(e.getName()).setValueOf("components".dotize(n),r);var o=this.getModuleSandbox(e.getName()).componentsQueue;o.splice(o.indexOf(n),1),0===o.length&&(this.componentExtensionsQueue.forEach(function(t){var i=a.logicalComponentExtension(t.module.getName(),t.extension);i.getValueOf("prototype.namespace")&&(n=[i.getValueOf("prototype.namespace"),n].join("::")),a.getModuleSandbox(e.getName()).updateValueOf("components".dotize(n),i)}),this.getModuleSandbox(e.getName()).instance.emit("ready"),t.getValueOf(e.getName()).isReady=!0,0<t.getValueOf(e.getName()).renderQueue.length&&this.getModuleSandbox(e.getName()).instance.emit.apply(this.getModuleSandbox(e.getName()).instance,t.getValueOf(e.getName()).renderQueue.pop()))}},{key:"addTemplate",value:function(e,t,n){return this.setValueOf("modulesTemplates".dotize(e.getName()),{})[t]=n,!0}},{key:"getTemplate",value:function(e,t){var n=this.setValueOf("modulesTemplates".dotize(e.getName()),{});if(!0===n.hasOwnProperty(t))return n[t]}},{key:"getComponentPrototype",value:function(e,t){return this.getModuleSandbox(e.getName()).components.getValueOf(t)}},{key:"isInstalled",value:function(e){return this.modules.getValueOf(e.dotize("isInstalled",!1))}},{key:"getModuleInstance",value:function(e){return this.getModuleSandbox(e.getName()).instance}},{key:"getModuleSandbox",value:function(e){return this.modules.setValueOf(e,this.moduleSandbox.createNewItem())}}],[{key:"getInstance",value:function(){return!1==e instanceof n&&(e=new n),e}},{key:"getModuleSandboxFacade",value:function(e){return i.setValueOf(e.getName(),new r(e))}}]),n}(),u=function(e){function n(e,t){_classCallCheck(this,n);var i=_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e));return i.moduleName=e,i.moduleBody=t,i.handler=s.getInstance(),i.handler.build(i),i}return _inherits(n,e),_createClass(n,[{key:"getName",value:function(){return this.moduleName}},{key:"getBody",value:function(){return this.moduleBody}},{key:"add",value:function(e,t){return this.handler.addComponent(this,e,t)}},{key:"addTemplate",value:function(e,t){return this.handler.addTemplate(this,e,t)}},{key:"getTemplate",value:function(e){return this.handler.getTemplate(this,e)}},{key:"getComponentPrototype",value:function(e){return this.handler.getComponentPrototype(this,e)}},{key:"getSandboxFacade",value:function(){return s.getModuleSandboxFacade(this)}},{key:"getEmitter",value:function(){return this.handler.getModuleInstance(this)}}],[{key:"load",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(new Loader).getModule(e),t.setValueOf(e,new o(e,n))}},{key:"init",value:function(){(new Loader).initialize()}},{key:"ready",value:function(){a.forEach(function(e){e()})}}]),n}(TJS.Events),l=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"parseComponentItems",value:function(e,t){t.updateHiddenData("items",{}),[].forEach.call(e.querySelectorAll("[data-item]"),function(e){if(e.isLive())return!1;t.getHiddenData("items")[e.itemName]=e,e.setEmitter(t.getEmitter()),e.live(),e.getEmitter().pipe(t.getEmitter())})}},{key:"parseTrNode",value:function(e){var t;return t=e,"TRCLONE"===e.nodeName&&(t=document.createElement("tr"),[].forEach.call(e.querySelectorAll("tdclone"),function(e){var n;n=document.createElement("td"),n.set(e.get()),[].forEach.call(e.attributes,function(e){n.setAttribute(e.name,e.value)}),t.appendChild(n)})),t}},{key:"compileVirtualFields",value:function(e,t){var n=void 0,i=void 0;n=t.getValueOf("fields",{}),i=t.getValueOf("rawItemData",{}),Object.keys(n).forEach(function(e){"function"==typeof n[e]&&i.updateValueOf(e,n[e].call(t,i))})}},{key:"bindData",value:function(e,t){function n(e,n){return function(i){var a;a=n.itemName,e.rawItemData[a]=i,t.getHiddenData("items")[a].set(i)}}var i;i=t.rawItemData,void 0===i&&(i={}),Object.keys(t.getHiddenData("items")).forEach(function(e){var a,r;if(a=t.getHiddenData("items")[e],r=i.getValueOf(e),t.templateData.getEmitter().on([e,"change"].join(":"),n(t,a)),t.templateData.getValueOf(e)||t.templateData.createObservableProperty(e),0!==r&&!r)return!1;t.templateData.getValueOf(e)||t.templateData.updateValueOf(a.itemName,r),a.set(r)})}},{key:"setUniques",value:function(e,t){t.getNode().hasAttribute("data-unique")&&(t.getNode().setAttribute(t.getNode().getAttribute("data-unique"),t.id),t.getNode().removeAttribute("data-unique")),[].forEach.call(t.getNode().querySelectorAll("[data-unique]"),function(e){e.hasAttribute("data-unique")&&(e.setAttribute(e.getAttribute("data-unique"),t.id),e.removeAttribute("data-unique"))})}},{key:"installListeners",value:function(e,t){function n(e,t){return function(n){e.apply(t,n)}}function i(e,t){return function(){e.getEmitter().emit("Parent::".dotize(t.name),arguments)}}t.getValueOf("events",[]).forEach(function(e){t.getEmitter().on(e.name,function(){for(var n=arguments.length,i=Array(n),a=0;a<n;a++)i[a]=arguments[a];e.handler.apply(t,i)})}),t.getValueOf("shouters",[]).forEach(function(e){-1===t.getValueOf("_hiddenData.shouters",[]).indexOf(e.name)&&(t.parentEmitter.on(e.name,i(t,e)),t.setValueOf("_hiddenData.shouters",[]).push(e.name)),t.getEmitter().on("Parent::".dotize(e.name),n(e.handler,t))}),null!==t.getLevelEmitter()&&t.getLevelEmitter().once("destroy",function(e){return function(){e.destroy()}}(t))}},{key:"callAfterMount",value:function(e,t){"function"==typeof t.getValueOf("mountState",!1)&&t.getValueOf("mountState").call(t,e)}},{key:"appendDataToContainers",value:function(e,t){function n(e,t,n){return function(){e.apply(t.getEmitter(),arguments),arguments[0]=t.name+"::"+arguments[0],[].push.call(arguments,t),n.getEmitter().emit.apply(n.getEmitter(),arguments)}}var i,a,r,o;if(r=t.rawData,o=void 0!==t.getValueOf("containers.feed",!1),!1==r instanceof Array&&!o)return!1;t.children=[],i=e.getContainers(),i.forEach(function(e){var i,s,u;return!e.hasAttribute("data-module")&&(u=e.getAttribute("data-container"),o&&void 0!==t.getValueOf("containers.feed",{})[u]&&(r=t.rawData.getValueOf(t.getValueOf("containers.feed")[u].replace("data.",""),t.rawData)),!1==r instanceof Array?(e.render(),!1):(a=r.softClone(),a=t.handler.filterContainerData(e,t,a),i=t.handler.getItemPrototypeForContainer(e,t,a),a.map(function(a){var r;s=new i,s.parentContainer=e,s.parentComponent=t,s.levelEmitter=new TJS.Events,t.parentEmitter.pipe(s.parentEmitter),t.getEmitter().pipe(s.getLevelEmitter()),s.parentEmitter.pipe(t.parentEmitter),r=s.getEmitter().emit,s.getEmitter().emit=n(r,s,t),e.eagerInsert(s.render(a)),t.children.push(s)}),void e.render()))})}},{key:"renderBlocks",value:function(e,t){var n;n=t.getValueOf("blocks",{}),0<Object.keys(n).length&&Object.keys(n).forEach(function(i){try{if(!0===n[i].defer)return!0}catch(e){}t.handler.renderOneBlock(n[i],i,e,t)})}},{key:"renderOneBlock",value:function(e,t,n,i,a,r){var o,s,u,l=!0;if(void 0===r&&(r=!1),void 0===a&&(l=!1),e=e||{},!e.getValueOf("item"))throw new Error("Using blocks on %s requires each block to have an item prototype defined.".sprintf(i.name));if(e.getValueOf("feed")||e.updateValueOf("feed","data"),a=a||i.getValueOf("rawItemData".dotize(e.getValueOf("feed").replace("data.","")),i.rawItemData),l||"data"===e.getValueOf("feed","")&&(a=i.rawItemData),u=e.item,"function"==typeof e.item&&!1===(u=e.item.call(i,a)))return!1;o=i.handler.getItemPrototype(u,i);try{s=new o}catch(e){return console.warn("Tried to construct non-existent/faulty component %s".sprintf(u)),console.warn("This is what the error looks like:",e),!1}e.getValueOf("id")&&(s.id=e.id),s.levelEmitter=new TJS.Events,s.parentComponent=i,i.parentEmitter.pipe(s.parentEmitter),i.getEmitter().pipe(s.getLevelEmitter()),s.parentEmitter.pipe(i.parentEmitter),r?(i.getValueOf("blockItems".dotize(t,u),{destroy:function(){}}).destroy(),i.updateValueOf("blockItems".dotize(t,u),s).render(a,n.getBlock(t))):i.setValueOf("blockItems".dotize(t,u),s).render(a,n.getBlock(t)),"data"===e.getValueOf("feed","")?i.rawItemData=a:i.updateValueOf("rawItemData".dotize(e.getValueOf("feed").replace("data.","")),a)}},{key:"runInitState",value:function(e,t){"function"==typeof t.getValueOf("initState")&&t.getValueOf("initState").apply(t,[t.rawItemData,t.rawData,e])}},{key:"runConstruct",value:function(e,t){"function"==typeof t.getValueOf("buildState")&&t.getValueOf("buildState").apply(t,[t.rawItemData,t.rawData,e])}},{key:"runbeforeBuildState",value:function(e,t){"function"==typeof t.getValueOf("beforeBuildState")&&t.getValueOf("beforeBuildState").apply(t,[e,t.rawItemData])}},{key:"filterContainerData",value:function(e,t,n){var i;return i=t.getValueOf("containers.filters.all",[]),i=i.concat(t.getValueOf("containers.filters",{})[e.getContainerName()]||[]),i.forEach(function(e){n=n.filter(e.bind(t))}),n}},{key:"getItemPrototypeForContainer",value:function(e,t,n){var i;if(i=t.getValueOf("containers.items")[e.getContainerName()]||t.getValueOf("containers.items.all"),"function"==typeof i&&(i=i(n)),void 0===i)throw new Error("Cannot create container %s items because the definition for the component %s is missing containers.items.%s".sprintf(e.getContainerName(),t.name,e.getContainerName()));return TJS.module(t.getModuleName()).getComponentPrototype(i)}},{key:"getItemPrototype",value:function(e,t){var n;if(n=e,void 0===e)throw new Error("Trying to fetch a prototype for %s on %s component, %s module, but there's no existing definition".sprintf(e,t.name,t.moduleName));return TJS.module(t.getModuleName()).getComponentPrototype(n)}},{key:"rebuildComponentState",value:function(e,t,n){if(!n)return!1;t.parentEmitter.removeAllListeners(),t.rawData=t.handler.reCreateRawData(t),t.rawItemData=t.handler.reCreateRawItemData(t)}},{key:"reCreateRawData",value:function(e){var t=[];return 0<e.children.length&&e.children.forEach(function(e){t.push(e.rawData.softClone()),e.getEmitter().removeAllListeners()}),t}},{key:"destroyChildren",value:function(e){Array.from(e.children).forEach(function(e){e.getHiddenData("belongsTo")&&TJS.module(e.getHiddenData("belongsTo").module).getSandboxFacade().singleInstance(e.getHiddenData("belongsTo").component).destroy()})}},{key:"reCreateRawItemData",value:function(e){var t;return void 0!==e.templateData&&(t=e.rawItemData.softClone()),t}},{key:"resetTemplateData",value:function(e){e.templateData={},e.templateData.setEmitter(e.getEmitter())}}],[{key:"getInstance",value:function(){return!1==n instanceof e&&(n=new e),n}}]),e}(),c=function(){function e(){_classCallCheck(this,e),this.construct.apply(this,arguments)}return _createClass(e,[{key:"construct",value:function(){if(this.isAbstract=this.abstract||!1,this.isAbstract)throw new Error("%s:%s cannot be created because it's an abstract component. It should be used only for extending it.".sprintf(this.getModuleName(),this.getName()));this.id="9d92n3f".toUniqueId(),this.setEmitter(new TJS.Events),this.handler=l.getInstance(),this.templateName=this.template,this.dataFeed=this.feed,this.templateNode=this.getTemplateNode().cloneNode(!0),this.children=[],this.hooks={},this.node=null,this.templateData={},this.templateData.setEmitter(this.getEmitter()),this.parentEmitter=new TJS.Events,this.levelEmitter=null,this.rawData=null,this.rawItemData=null,this.parentContainer=null,this.blockItems={},this.active=!1,this.previousRender=null,this.previousData=null,this.previousContainer=null,this.previousDataObject=null}},{key:"getTemplateName",value:function(){return void 0!==this.namespace?[this.namespace,this.templateName].join("::"):this.templateName}},{key:"getTemplateNode",value:function(){var e=TJS.module(this.getModuleName()).getTemplate(this.getTemplateName());if(void 0!==this.namespace&&void 0===e&&(e=TJS.module(this.getModuleName()).getTemplate(this.templateName)),void 0===e)throw new Error("Component %s tried to use an inexistent html template %s".sprintf(this.getName(),this.templateName));return e}},{key:"getName",value:function(){return this.name}},{key:"getParentComponent",value:function(){return this.parentComponent||null}},{key:"getModuleName",value:function(){return this.moduleName}},{key:"shout",value:function(){return this.parentEmitter.emit.apply(this.parentEmitter,arguments),arguments[0]=[this.getName(),arguments[0]].join("::"),this.parentEmitter.emit.apply(this.parentEmitter,arguments),TJS.module(this.getModuleName()).getEmitter().emit.apply(TJS.module(this.getModuleName()).getEmitter(),arguments),arguments[0]=[arguments[0],this.id].join("::"),this.parentEmitter.emit.apply(this.parentEmitter,arguments),!0}},{key:"getLevelEmitter",value:function(){return this.levelEmitter}},{key:"set",value:function(e,t){this.templateData.updateValueOf(e,t),this.rawItemData.updateValueOf(e,t)}},{key:"get",value:function(e){return this.templateData.getValueOf(e,this.rawItemData.getValueOf(e))}},{key:"getLive",value:function(e){return void 0!==this.getHiddenData("items")[e]?this.getHiddenData("items")[e].get():null}},{key:"getData",value:function(){return this.rawItemData||this.rawData}},{key:"getPristineNode",value:function(){return this.handler.parseTrNode(this.templateNode.cloneNode(!0))}},{key:"getNode",value:function(){return this.node}},{key:"getContainer",value:function(){return this.previousRender.parentContainer}},{key:"getHtmlElement",value:function(e){return this.getHiddenData("items")[e]||null}},{key:"render",value:function(e,t,n){var i,a;return this.previousData=e,this.previousContainer=t,this.previousDataObject=n,void 0!==e&&this.dataFeed&&(e=e.getValueOf(this.dataFeed.replace("data.",""))),this.previousRender&&(t||(t=this.previousRender.parentContainer),this.destroy()),i=this.getPristineNode(),i.updateHiddenData("belongsTo",{module:this.getModuleName(),component:this.getName()}),this.handler.resetTemplateData(this),a=e,void 0!==n&&(a=n),!0==e instanceof Array&&(a={}),this.handler.rebuildComponentState(i,this,void 0===e&&void 0===t&&void 0===n),this.rawData=e||this.rawData,this.rawItemData=a||this.rawItemData,void 0!==this.rawItemData&&null!==this.rawItemData&&(this.handler.runbeforeBuildState(i,this),this.handler.parseComponentItems(i,this),this.handler.runConstruct(i,this),this.handler.compileVirtualFields(i,this),this.handler.bindData(i,this),this.node=i,this.handler.runInitState(i,this),this.handler.appendDataToContainers(i,this),this.handler.installListeners(i,this),this.handler.renderBlocks(i,this),this.handler.setUniques(i,this),this.active=!0,!0==t instanceof HTMLElement&&t.hasAttribute("data-module")&&this.handler.destroyChildren(t),this.previousRender?(this.previousRender.parentNode!==t&&t.appendChild(this.previousRender),this.previousRender.parentNode.replaceChild(i,this.previousRender)):t&&t.appendChild(i),this.previousRender=i,this.previousRender.parentContainer=t,this.handler.callAfterMount(i,this),i)}},{key:"refreshBlock",value:function(e,t){return!!this.previousRender&&(!!this.getValueOf("blocks",{})[e]&&void this.handler.renderOneBlock(this.getValueOf("blocks",{})[e],e,this.previousRender,this,t,!0))}},{key:"renderBlock",value:function(e,t,n){if(!this.previousRender)throw new Error("Cannot render a block on %s component if it had no previous render".sprintf(this.getName()));if(!this.getValueOf("blocks",{})[e])throw new Error("Cannot render a block on %s component if the block has no definition".sprintf(this.getName()));this.handler.renderOneBlock(this.getValueOf("blocks",{})[e],e,this.previousRender,this,t,n)}},{key:"destroy",value:function(){return this.handler.resetTemplateData(this),this.getEmitter().removeAllListeners(),null!==this.getLevelEmitter()&&this.getLevelEmitter().removeAllListeners(),this.getValueOf("destroyState",function(){return function(){}}).apply(this,[this.rawItemData]),this.active=!1,this.previousRender.parentNode&&this.previousRender.parentNode.removeChild(this.previousRender),this.getEmitter().emit("destroy",this),this.unsetValueOf("blockItems").setValueOf("blockItems",{}),this.previousRender=null,this.previousData=null,this.previousContainer=null,this.previousDataObject=null,!0}}],[{key:"extend",value:function(t,n){var i,a;return void 0===n&&(n=e.prototype),i=Object.create(n),Object.keys(t).forEach(function(e){i.updateValueOf(e,t[e])}),a=function(){this.construct.apply(this,arguments)},a.prototype=i,a}}]),e}();Object.defineProperty(TJS,"module",{value:function(){var e;return e=function(e,t){return new u(e,t)},e.load=u.load,e.init=u.init,TJS.dom.ready(function(){e.init(),u.ready()}),e}(),enumerable:!1,writable:!1}),Object.defineProperty(TJS,"ready",{value:function(e){"function"==typeof e&&a.push(e)},enumerable:!1,writable:!1})}();